The authentication process for the Dahua NVR RPC API is a custom challenge-response mechanism. Unlike standard HTTP Digest Authentication, this flow uses a two-step JSON-RPC method to establish a session. The client proves it knows the password by responding to a server-generated challenge.Step 1: First Login Request (Challenge Request)The client initiates the login process by calling the global.login RPC method with the username and an empty password. This acts as a request for an authentication challenge from the server.RPC Method: global.loginEndpoint: /RPC2_LoginExample Client Request:{
  "method": "global.login",
  "params": {
    "userName": "admin",
    "password": "",
    "clientType": "Web3.0",
    "loginType": "Direct"
  },
  "id": 1
}
Step 2: Server Issues a ChallengeThe server receives the initial request and responds with a challenge. Instead of a standard 401 HTTP status, it sends a JSON-RPC response containing the necessary parameters for the client to create an authenticated response. This response also includes a session ID that must be used in subsequent requests.Key Fields in the Server's Response:session: A unique session identifier.params.random: A random string (nonce) generated by the server.params.realm: The authentication realm.params.encryption: The required encryption/hashing method (e.g., "Default" or "Basic").Example Server Response:{
  "id": 1,
  "session": "100000001",
  "result": false,
  "error": {
    "code": 401,
    "message": "Unauthorized"
  },
  "params": {
    "random": "abcdef123456",
    "realm": "Login",
    "encryption": "Default"
  }
}
Step 3: Client Calculates the Authenticated ResponseThe client now uses the parameters from the server's challenge, along with the user's credentials, to calculate the final password hash. The calculation method depends on the encryption type returned by the server.Calculation for "Default" EncryptionThis is the most common method. The response is calculated as follows:Calculate HA1: A hash of the user's credentials and the server's realm.Formula: HA1 = MD5(username:realm:password)The result of this hash should be in uppercase.Calculate the Final response: A hash combining the username, the server's random nonce, and HA1.Formula: response = MD5(username:random:HA1)The final result should be in uppercase.Calculation for "Basic" EncryptionIf the server requests "Basic" encryption, the calculation is simpler:Formula: response = Base64Encode(username:password)Step 4: Second Login Request (Authenticated Request)The client calls the global.login method again. This time, it includes the calculated response as the password and sends the session ID received in Step 2.RPC Method: global.loginEndpoint: /RPC2_LoginExample Authenticated Client Request (for "Default" encryption):{
  "method": "global.login",
  "params": {
    "userName": "admin",
    "password": "CALCULATED_RESPONSE_HASH",
    "clientType": "Web3.0",
    "authorityType": "Default",
    "loginType": "Direct"
  },
  "id": 2,
  "session": "100000001"
}
Step 5: Final Server ResponseThe server validates the password (the calculated response hash) from the client.If Successful ✅: The server returns a JSON-RPC response with result: true, confirming the session is now authenticated. The client can now use the session ID for all subsequent API calls.Example Success Response:{
  "id": 2,
  "session": "100000001",
  "result": true
}
If Unsuccessful ❌: The server returns a response with result: false and an error object detailing the reason for failure (e.g., invalid password, user locked).Example Failure Response:{
  "id": 2,
  "session": "100000001",
  "result": false,
  "error": {
    "code": 268632071,
    "message": "Password error!"
  },
  "params": {
    "error": "PasswordNotValid"
  }
}
Step 6: Keeping the Session AliveOnce logged in, the client must periodically call the global.keepAlive method to prevent the session from expiring. The provided source code suggests doing this every 60 seconds.RPC Method: global.keepAliveEndpoint: /RPC2Example Keep-Alive Request:{
  "method": "global.keepAlive",
  "params": {
    "timeout": 300,
    "active": true
  },
  "id": 3,
  "session": "100000001"
}
